# Feature Specification: チケット一覧の子チケット追加アイコン

**Feature Branch**: `001-add-child-ticket-icon`  
**Created**: 2025-12-28  
**Status**: Draft  
**Input**: User description: "チケット一覧の各チケットの右側に子チケット追加アイコンを追加してクリックすると追加できるようにする。アイコンクリックした際はエディタを表示してメタデータにparent: 親チケットNoを追加する"

## Clarifications

### Session 2025-12-28

- Q: 作成権限がない場合のアイコン表示は？ → A: 非表示にする
- Q: 子チケット作成時のプロジェクトは？ → A: 親チケットと同じプロジェクト
- Q: アイコンクリック時の挙動は？ → A: 新規チケット編集画面を開いて入力・保存する
- Q: メタデータの parent の記法は？ → A: 数値IDのみ（例: parent: 123）
- Q: 親チケット番号が取得できない場合の扱いは？ → A: エラーメッセージを表示して中断する

## User Scenarios & Testing *(mandatory)*

**Constitution reminder**: Unit tests are mandatory and must be defined before
implementation. Ensure scenarios can be covered by unit tests.

### User Story 1 - 子チケット追加アイコンから作成を開始する (Priority: P1)

ユーザーはチケット一覧の各チケット行で子チケット追加アイコンをクリックし、親チケットが指定された新規チケットの編集を開始できる。

**Why this priority**: 一覧からの子チケット作成は作業の起点となるため、最優先で提供する必要がある。

**Independent Test**: 一覧の任意チケットでアイコンをクリックし、親チケット番号が設定された編集画面が表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** チケット一覧が表示されている, **When** 任意のチケット行の子チケット追加アイコンをクリックする, **Then** 新規チケットの編集画面が開き、親チケット番号が設定されている
2. **Given** チケット一覧が表示されている, **When** 複数のチケット行でアイコンをクリックする, **Then** それぞれの親チケット番号が正しく設定された編集画面が開く

---

### User Story 2 - 作成権限に応じてアイコンの挙動が整合する (Priority: P2)

ユーザーはチケット作成が許可されていない場合、子チケット追加アイコンを利用できない。

**Why this priority**: 権限に合わない操作導線があると混乱を招くため。

**Independent Test**: 作成不可の状態で一覧を表示したとき、アイコンが表示されないことを確認できる。

**Acceptance Scenarios**:

1. **Given** チケット作成が許可されていない, **When** チケット一覧を表示する, **Then** 子チケット追加アイコンが表示されない

---

### Edge Cases

- 一覧にチケットが存在しない場合は子チケット追加アイコンが表示されない
- 親チケット番号が取得できない場合は編集画面を開かずエラー通知する

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムはチケット一覧の各チケット行の右側に子チケット追加アイコンを表示しなければならない
- **FR-002**: ユーザーが子チケット追加アイコンをクリックしたとき、新規チケットの編集画面を開かなければならない
- **FR-003**: システムは新規チケット編集画面のメタデータに親チケット番号を設定しなければならない
- **FR-006**: システムは子チケット作成時に親チケットと同じプロジェクトを設定しなければならない
- **FR-007**: システムはメタデータの parent に数値IDのみを設定しなければならない
- **FR-004**: チケット作成が許可されていない場合、子チケット追加アイコンを表示してはならない
- **FR-005**: 親チケット番号を取得できない場合、編集画面を開かずエラーを通知しなければならない

### Key Entities *(include if feature involves data)*

- **チケット一覧項目**: 一覧上のチケット表示行（子チケット追加アイコンを含む）
- **親チケット番号**: 子チケット作成時に紐づく親チケット識別子
- **メタデータ parent**: 親チケット番号の数値ID
- **子チケット編集状態**: 親チケット番号が設定された新規チケットの編集内容

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 子チケット追加アイコンから編集画面を開ける成功率が99%以上
- **SC-002**: 親チケット番号の設定ミスが0件
- **SC-003**: 作成不可ユーザーがアイコンを操作できる事例が0件
- **SC-004**: アイコン操作から編集画面表示までの体感待ち時間が1秒以内

## Assumptions

- 子チケット作成の権限制御は既存のチケット作成権限と同じ基準で判定する
- 子チケット追加アイコンはチケット一覧以外のビューには追加しない
- 子チケットは親チケットと同じプロジェクトに作成する
