# Research: コメント画像アップロード

## Decision 1: 画像リンク処理の基準
- Decision: チケット編集時と同等の対象判定（拡張子・形式・サイズ）をそのまま適用する。
- Rationale: 既存挙動と一致させることでユーザー期待と運用の整合性を保てる。
- Alternatives considered: コメント専用の判定基準を追加する（不整合と運用負荷が増えるため採用しない）。

## Decision 2: アップロード失敗時の扱い
- Decision: 画像アップロードが1つでも失敗した場合はコメント保存を失敗扱いにする。
- Rationale: 画像が重要な業務情報となるケースが多く、部分成功は誤解を生みやすい。
- Alternatives considered: 本文のみ保存・一部削除して保存（ユーザーが欠落に気付きにくいため採用しない）。

## Decision 3: 再評価タイミング
- Decision: コメント保存のたびに画像リンクを再評価し、必要なアップロードを行う。
- Rationale: 編集でリンクが追加・変更・削除された場合も一貫して反映できる。
- Alternatives considered: 変更時のみ評価（差分検出の複雑化によりテスト負荷が増えるため採用しない）。

## Decision 4: 閲覧権限
- Decision: 既存のコメント閲覧権限に準拠する。
- Rationale: 既存権限モデルと整合し、意図しない漏洩を防げる。
- Alternatives considered: 画像を別権限にする/公開にする（運用が複雑化するため採用しない）。
