# Feature Specification: プロジェクト別テンプレート

**Feature Branch**: `001-project-template`  
**Created**: 2025-12-26  
**Status**: Draft  
**Input**: User description: "redmineのプロジェクトごとにテンプレートを持てるようにする。"

## Clarifications

### Session 2025-12-26

- Q: 同一プロジェクト名を含むテンプレートが複数ある場合の扱いは? → A: 完全一致が1件のみ有効（複数なら既定テンプレートへフォールバック）
- Q: プロジェクト名とテンプレート名の照合は大文字小文字を区別するか? → A: 完全一致（大文字小文字は無視）
- Q: テンプレートファイル名の判別ルールは? → A: ファイル名にプロジェクト名の完全一致を含める
- Q: 既定テンプレートの識別方法は? → A: 固定ファイル名（例: default.md）

## User Scenarios & Testing *(mandatory)*

**Constitution reminder**: Unit tests are mandatory and must be defined before
implementation. Ensure scenarios can be covered by unit tests.

### User Story 1 - プロジェクト別テンプレート適用 (Priority: P1)

ユーザーはチケット作成時に、選択したRedmineプロジェクト名を含むテンプレートがあれば自動で適用できる。

**Why this priority**: 日常的なチケット作成の負荷を最も減らし、入力ミスを防げるため。

**Independent Test**: 1つのプロジェクトにテンプレートを設定し、新規作成時に内容が反映されることを確認できる。

**Acceptance Scenarios**:

1. **Given** プロジェクト名を含むテンプレートファイルが存在するプロジェクトを選択している, **When** 新規チケットを作成する, **Then** そのテンプレート内容が初期入力として反映される
2. **Given** 複数プロジェクト名を含むテンプレートが存在する, **When** プロジェクトを切り替えて新規作成する, **Then** 選択したプロジェクト名のテンプレートのみが反映される

---

### User Story 2 - テンプレートの設定と更新 (Priority: P2)

ユーザーはテンプレートファイルを所定のフォルダに追加・更新することで、プロジェクト別テンプレートを管理できる。

**Why this priority**: 運用ルールの変更に合わせてテンプレートを継続的に管理する必要があるため。

**Independent Test**: 既存テンプレートファイルを編集し、次回の新規作成で更新内容が使われることを確認できる。

**Acceptance Scenarios**:

1. **Given** 既にテンプレートファイルが配置済み, **When** テンプレート内容を更新する, **Then** 次回以降の新規作成で更新後の内容が反映される

---

### User Story 3 - テンプレート未設定時の既定動作 (Priority: P3)

ユーザーはプロジェクト別テンプレートがない場合でも、既定のテンプレートでチケット作成を開始できる。

**Why this priority**: 一部プロジェクトのみテンプレートを用意する運用が一般的なため。

**Independent Test**: プロジェクト別テンプレートがないプロジェクトで新規作成し、既定テンプレートが使われることを確認できる。

**Acceptance Scenarios**:

1. **Given** プロジェクト別テンプレートが存在しないプロジェクトを選択している, **When** 新規チケットを作成する, **Then** 既定テンプレートが初期入力として反映される

### Edge Cases

- テンプレートが空、または内容が不完全な場合はどう扱うか?
- 同一プロジェクト名を含むテンプレートが複数ある場合は既定テンプレートへフォールバックする
- テンプレート設定済みプロジェクトが削除・無効化された場合はどう扱うか?

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システム MUST `redmine-client.editorStorageDirectory` の `templates` フォルダ内のテンプレートを読み取れる
- **FR-002**: システム MUST テンプレートファイル名に含まれるプロジェクト名で適用先を判別する
- **FR-002a**: システム MUST プロジェクト名の照合は大文字小文字を区別しない完全一致とする
- **FR-002b**: システム MUST テンプレートファイル名にプロジェクト名の完全一致を含めるルールを採用する
- **FR-003**: システム MUST チケット作成時に選択されたプロジェクト名のテンプレートを自動適用する
- **FR-004**: システム MUST プロジェクト別テンプレートがない場合は既定テンプレートを適用する
- **FR-004a**: システム MUST 既定テンプレートを固定ファイル名で識別する
- **FR-005**: システム MUST プロジェクト切り替え時に対応するテンプレートを正しく適用する
- **FR-006**: システム MUST テンプレート適用の有無をユーザーが確認できるように表示する
- **FR-007**: システム MUST 同一プロジェクト名を含むテンプレートが複数ある場合は既定テンプレートへフォールバックする

### Key Entities *(include if feature involves data)*

- **Project**: Redmineのプロジェクト。識別子と表示名を持つ
- **Template**: チケット作成時に適用される本文テンプレート。ファイル名にプロジェクト名を含む
- **Default Template**: プロジェクト別テンプレートがない場合に適用されるテンプレート

## Assumptions

- テンプレートはテキスト本文として扱い、画像や添付ファイルは対象外とする
- テンプレートが未設定でもチケット作成は継続できる
- 既定テンプレートは常に利用可能な状態とする

## Dependencies

- Redmineのプロジェクト一覧を利用できること
- 既存のテンプレート機能が引き続き利用可能であること

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: テンプレート設定済みプロジェクトでの新規作成において、初期入力反映までが5秒以内で完了する
- **SC-002**: テンプレート適用が有効な新規作成のうち、初回試行で完了できるユーザー割合が90%以上である
- **SC-003**: テンプレート未設定プロジェクトでの新規作成時、迷ったと感じたユーザーが10%未満である
- **SC-004**: テンプレートに起因する入力ミスの報告が導入前比で30%以上減少する
