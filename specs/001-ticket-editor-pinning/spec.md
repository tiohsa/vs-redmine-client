# Feature Specification: Ticket Editor Pinning

**Feature Branch**: `001-ticket-editor-pinning`  
**Created**: 2025-12-26  
**Status**: Draft  
**Input**: User description: "チケット選択した場合にエディタが開き、次のチケットを選択した際も新規エディタが開くので未保存のエディタの数が増える。エディタ固定にして未保存のような状態でなくチケット毎に専用のエディタにしてそのエディタに紐づくコメントは同じエディタで処理する。また任意に新規エディタも追加してそちらでも編集可能にもする。"

## Clarifications

### Session 2025-12-26

- Q: 追加エディタが複数ある状態でチケットを再選択した場合、どのエディタにフォーカスするか? → A: 最後にアクティブだったエディタへ切り替える
- Q: チケット切替時にコメント編集中の下書きはどう扱うか? → A: チケット切替時もコメント下書きをそのチケットのエディタに保持する
- Q: 既存のチケット専用エディタを閉じた場合はどう扱うか? → A: 次回のチケット選択で新しい専用エディタを開く
- Q: 同一チケットの追加エディタ数の上限はあるか? → A: 上限は設けない
- Q: 追加エディタがある状態でチケットを再選択し専用エディタが閉じられていた場合はどうするか? → A: 既存エディタは閉じずに新しい専用エディタを開く

## User Scenarios & Testing *(mandatory)*

**Constitution reminder**: Unit tests are mandatory and must be defined before
implementation. Ensure scenarios can be covered by unit tests.

### User Story 1 - チケットごとの専用エディタに再利用 (Priority: P1)

ユーザーがチケットを選択すると、そのチケット専用のエディタが開く。すでにそのチケットのエディタが開いている場合は、新規エディタを増やさず既存の専用エディタに切り替わる。

**Why this priority**: 未保存のように見えるエディタが増える問題を解消し、作業の混乱を防ぐため。

**Independent Test**: チケットA/Bを順に選択し、A再選択時に新規エディタが増えず既存Aエディタに切り替わることを確認できる。

**Acceptance Scenarios**:

1. **Given** チケットAの専用エディタが開いている, **When** チケットBを選択する, **Then** チケットB専用エディタが1つ開く
2. **Given** チケットAとBの専用エディタが開いている, **When** チケットAを再選択する, **Then** 新規エディタは増えず既存のチケットAエディタが表示される

---

### User Story 2 - コメントは同じチケットエディタで扱う (Priority: P2)

ユーザーがチケットのコメントを追加・編集する場合、そのチケット専用エディタ内で処理できる。

**Why this priority**: チケットとコメントの作業場所を一貫させ、作業中のエディタを増やさないため。

**Independent Test**: チケットを開いてコメント操作を行い、別エディタが増えず同じエディタ内で完結することを確認できる。

**Acceptance Scenarios**:

1. **Given** チケットAの専用エディタが開いている, **When** コメント追加を行う, **Then** 同じチケットAエディタ内でコメント入力・保存が行える

---

### User Story 3 - 任意に新規エディタを追加して編集 (Priority: P3)

ユーザーは必要に応じて、同じチケットに対して追加の新規エディタを開き、そこでも編集できる。

**Why this priority**: 併行作業や比較のために複数表示が必要な場合に対応するため。

**Independent Test**: チケットAの専用エディタを開いた状態で追加エディタ作成を行い、2つ目のエディタで編集できることを確認できる。

**Acceptance Scenarios**:

1. **Given** チケットAの専用エディタが開いている, **When** 追加エディタを作成する, **Then** チケットAに紐づく2つ目のエディタが開く

---

### Edge Cases

- 既存のチケット専用エディタを閉じた後に同じチケットを選択した場合、新しい専用エディタを開く
- 追加エディタが複数ある状態でチケットを再選択した場合、最後にアクティブだったエディタにフォーカスされる
- コメント操作中にチケットを切り替えた場合、下書きはそのチケットのエディタに保持される
- 追加エディタが開いている状態で専用エディタが閉じられていた場合、チケット再選択で既存エディタは閉じず新しい専用エディタを開く

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムはチケットごとに専用エディタを1つ割り当てること
- **FR-002**: 既に専用エディタがあるチケットを選択した場合、システムは新規エディタを作成せず既存エディタを表示すること
- **FR-003**: チケットに紐づくコメントの追加・編集は同じチケット専用エディタ内で完結すること
- **FR-004**: ユーザーは任意に同一チケットの追加エディタを作成できること
- **FR-005**: 追加エディタも同じチケットに紐づく内容を表示・編集できること
- **FR-006**: チケット選択による自動表示では追加エディタを増やさないこと
- **FR-007**: 同一チケットのエディタが複数ある場合、チケット再選択時は最後にアクティブだったエディタを表示すること
- **FR-008**: コメントの下書きはチケットに紐づいて保持され、チケット切替後も元のチケットエディタで継続編集できること
- **FR-009**: チケット専用エディタを閉じた場合、そのチケット再選択時は新しい専用エディタを作成すること
- **FR-010**: 同一チケットの追加エディタ作成数に上限を設けないこと
- **FR-011**: 追加エディタがある状態で専用エディタが閉じられていた場合、チケット再選択時に既存エディタを閉じず新しい専用エディタを開くこと

### Key Entities *(include if feature involves data)*

- **Ticket**: チケットの識別情報と本文・コメントを含む作業単位
- **Ticket Editor**: 特定チケットに紐づく編集画面のインスタンス
- **Comment Draft**: チケットエディタ内で編集中のコメント内容

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 10件の異なるチケットを順に選択した場合、専用エディタの自動作成は各チケットにつき最大1つに収まる
- **SC-002**: 既に開いているチケットを再選択した際、1秒以内に既存エディタへ切り替わる
- **SC-003**: コメント追加・編集が別エディタを増やさず同一エディタ内で完了できる割合が100%である
- **SC-004**: 追加エディタ作成後も、ユーザーの編集完了率が90%以上維持される

## Assumptions

- 追加エディタは明示的なユーザー操作によってのみ作成される
- 追加エディタは同一チケットの編集を目的とし、チケットの関連情報を表示する

## Out of Scope

- チケット選択以外の操作で自動的に新規エディタを増やす挙動
- チケットと無関係な汎用メモ用途のエディタ機能
